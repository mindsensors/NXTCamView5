

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>10. Floating Point instructions &mdash; MicroPython 1.8 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/customstyle.css" type="text/css" />
  

  
    <link rel="top" title="MicroPython 1.8 documentation" href="../index.html"/>
        <link rel="up" title="Inline Assembler for Thumb2 architectures" href="asm_thumb2_index.html"/>
        <link rel="next" title="11. Assembler Directives" href="asm_thumb2_directives.html"/>
        <link rel="prev" title="9. Miscellaneous instructions" href="asm_thumb2_misc.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> MicroPython
          

          
            
            <img src="../_static/web-logo-sticky.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                1.8
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../openmvcam/quickref.html">Quick reference for the openmvcam</a></li>
<li class="toctree-l1"><a class="reference internal" href="../openmvcam/tutorial/index.html">OpenMV Cam Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../library/index.html">MicroPython libraries</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">The MicroPython language</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="repl.html">The MicroPython Interactive Interpreter Mode (aka REPL)</a></li>
<li class="toctree-l2"><a class="reference internal" href="isr_rules.html">Writing interrupt handlers</a></li>
<li class="toctree-l2"><a class="reference internal" href="speed_python.html">Maximizing Python Speed</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="asm_thumb2_index.html">Inline Assembler for Thumb2 architectures</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="asm_thumb2_index.html#document-conventions">Document conventions</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="asm_thumb2_index.html#instruction-categories">Instruction Categories</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="asm_thumb2_mov.html">1. Register move instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="asm_thumb2_ldr.html">2. Load register from memory</a></li>
<li class="toctree-l4"><a class="reference internal" href="asm_thumb2_str.html">3. Store register to memory</a></li>
<li class="toctree-l4"><a class="reference internal" href="asm_thumb2_logical_bit.html">4. Logical &amp; Bitwise instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="asm_thumb2_arith.html">5. Arithmetic instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="asm_thumb2_compare.html">6. Comparison instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="asm_thumb2_label_branch.html">7. Branch instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="asm_thumb2_stack.html">8. Stack push and pop</a></li>
<li class="toctree-l4"><a class="reference internal" href="asm_thumb2_misc.html">9. Miscellaneous instructions</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="">10. Floating Point instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="asm_thumb2_directives.html">11. Assembler Directives</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="asm_thumb2_index.html#usage-examples">Usage examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="asm_thumb2_index.html#references">References</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">MicroPython license information</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">MicroPython</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">The MicroPython language</a> &raquo;</li>
      
          <li><a href="asm_thumb2_index.html">Inline Assembler for Thumb2 architectures</a> &raquo;</li>
      
    <li>10. Floating Point instructions</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/reference/asm_thumb2_float.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="floating-point-instructions">
<h1>10. Floating Point instructions<a class="headerlink" href="#floating-point-instructions" title="Permalink to this headline">¶</a></h1>
<p>These instructions support the use of the ARM floating point coprocessor
(on platforms such as the Pyboard and the OpenMV Cam which are equipped with one). The FPU
has 32 registers known as <code class="docutils literal"><span class="pre">s0-s31</span></code> each of which can hold a single
precision floating point number. Data can be passed between the FPU registers and the
ARM core registers with the <code class="docutils literal"><span class="pre">vmov</span></code> instruction.</p>
<p>Note that MicroPython doesn&#8217;t support passing floats to
assembler functions, nor can you put a float into <code class="docutils literal"><span class="pre">r0</span></code> and expect a
reasonable result. There are two ways to overcome this. The first is to
use arrays, and the second is to pass and/or return integers and convert
to and from floats in code.</p>
<div class="section" id="document-conventions">
<h2>10.1. Document conventions<a class="headerlink" href="#document-conventions" title="Permalink to this headline">¶</a></h2>
<p>Notation: <code class="docutils literal"><span class="pre">Sd,</span> <span class="pre">Sm,</span> <span class="pre">Sn</span></code> denote FPU registers, <code class="docutils literal"><span class="pre">Rd,</span> <span class="pre">Rm,</span> <span class="pre">Rn</span></code> denote ARM core
registers. The latter can be any ARM core register although registers
<code class="docutils literal"><span class="pre">R13-R15</span></code> are unlikely to be appropriate in this context.</p>
</div>
<div class="section" id="arithmetic">
<h2>10.2. Arithmetic<a class="headerlink" href="#arithmetic" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>vadd(Sd, Sn, Sm) <code class="docutils literal"><span class="pre">Sd</span> <span class="pre">=</span> <span class="pre">Sn</span> <span class="pre">+</span> <span class="pre">Sm</span></code></li>
<li>vsub(Sd, Sn, Sm) <code class="docutils literal"><span class="pre">Sd</span> <span class="pre">=</span> <span class="pre">Sn</span> <span class="pre">-</span> <span class="pre">Sm</span></code></li>
<li>vneg(Sd, Sm) <code class="docutils literal"><span class="pre">Sd</span> <span class="pre">=</span> <span class="pre">-Sm</span></code></li>
<li>vmul(Sd, Sn, Sm) <code class="docutils literal"><span class="pre">Sd</span> <span class="pre">=</span> <span class="pre">Sn</span> <span class="pre">*</span> <span class="pre">Sm</span></code></li>
<li>vdiv(Sd, Sn, Sm) <code class="docutils literal"><span class="pre">Sd</span> <span class="pre">=</span> <span class="pre">Sn</span> <span class="pre">/</span> <span class="pre">Sm</span></code></li>
<li>vsqrt(Sd, Sm) <code class="docutils literal"><span class="pre">Sd</span> <span class="pre">=</span> <span class="pre">sqrt(Sm)</span></code></li>
</ul>
<p>Registers may be identical: <code class="docutils literal"><span class="pre">vmul(S0,</span> <span class="pre">S0,</span> <span class="pre">S0)</span></code> will execute <code class="docutils literal"><span class="pre">S0</span> <span class="pre">=</span> <span class="pre">S0*S0</span></code></p>
</div>
<div class="section" id="move-between-arm-core-and-fpu-registers">
<h2>10.3. Move between ARM core and FPU registers<a class="headerlink" href="#move-between-arm-core-and-fpu-registers" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>vmov(Sd, Rm) <code class="docutils literal"><span class="pre">Sd</span> <span class="pre">=</span> <span class="pre">Rm</span></code></li>
<li>vmov(Rd, Sm) <code class="docutils literal"><span class="pre">Rd</span> <span class="pre">=</span> <span class="pre">Sm</span></code></li>
</ul>
<p>The FPU has a register known as FPSCR, similar to the ARM core&#8217;s APSR, which stores condition
codes plus other data. The following instructions provide access to this.</p>
<ul class="simple">
<li>vmrs(APSR_nzcv, FPSCR)</li>
</ul>
<p>Move the floating-point N, Z, C, and V flags to the APSR N, Z, C, and V flags.</p>
<p>This is done after an instruction such as an FPU
comparison to enable the condition codes to be tested by the assembler
code. The following is a more general form of the instruction.</p>
<ul class="simple">
<li>vmrs(Rd, FPSCR) <code class="docutils literal"><span class="pre">Rd</span> <span class="pre">=</span> <span class="pre">FPSCR</span></code></li>
</ul>
</div>
<div class="section" id="move-between-fpu-register-and-memory">
<h2>10.4. Move between FPU register and memory<a class="headerlink" href="#move-between-fpu-register-and-memory" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>vldr(Sd, [Rn, offset]) <code class="docutils literal"><span class="pre">Sd</span> <span class="pre">=</span> <span class="pre">[Rn</span> <span class="pre">+</span> <span class="pre">offset]</span></code></li>
<li>vstr(Sd, [Rn, offset]) <code class="docutils literal"><span class="pre">[Rn</span> <span class="pre">+</span> <span class="pre">offset]</span> <span class="pre">=</span> <span class="pre">Sd</span></code></li>
</ul>
<p>Where <code class="docutils literal"><span class="pre">[Rn</span> <span class="pre">+</span> <span class="pre">offset]</span></code> denotes the memory address obtained by adding Rn to the offset. This
is specified in bytes. When accessing arrays of floats the offset must always be a multiple of four bytes
since each floating point value occupies a 32 bit word.</p>
</div>
<div class="section" id="data-comparison">
<h2>10.5. Data Comparison<a class="headerlink" href="#data-comparison" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>vcmp(Sd, Sm)</li>
</ul>
<p>Compare the values in Sd and Sm and set the FPU N, Z,
C, and V flags. This would normally be followed by <code class="docutils literal"><span class="pre">vmrs(APSR_nzcv,</span> <span class="pre">FPSCR)</span></code>
to enable the results to be tested.</p>
</div>
<div class="section" id="convert-between-integers-and-floats">
<h2>10.6. Convert between integers and floats<a class="headerlink" href="#convert-between-integers-and-floats" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>vcvt_f32_s32(Sd, Sm) <code class="docutils literal"><span class="pre">Sd</span> <span class="pre">=</span> <span class="pre">float(Sm)</span></code></li>
<li>vcvt_s32_f32(Sd, Sm) <code class="docutils literal"><span class="pre">Sd</span> <span class="pre">=</span> <span class="pre">int(Sm)</span></code></li>
</ul>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="asm_thumb2_directives.html" class="btn btn-neutral float-right" title="11. Assembler Directives" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="asm_thumb2_misc.html" class="btn btn-neutral" title="9. Miscellaneous instructions" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014-2017, Damien P. George, OpenMV LLC, and contributors.
      Last updated on 27 Mar 2017.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  <!--
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Ports and Versions</span>
    openmvcam (latest)
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Ports</dt>
      
        <dd><a href="//en/latest/unix">unix</a></dd>
      
        <dd><a href="//en/latest/pyboard">pyboard</a></dd>
      
        <dd><a href="//en/latest/wipy">wipy</a></dd>
      
        <dd><a href="//en/latest/esp8266">esp8266</a></dd>
      
        <dd><a href="//en/latest/openmvcam">openmvcam</a></dd>
      
    </dl>
    <dl>
      <dt>Versions</dt>
      
        <dd><a href="//en/latest/openmvcam">latest</a></dd>
      
    </dl>
    -->
    <!--
    <dl>
      <dt>Downloads</dt>
      
    </dl>
    -->
    <!--
    <hr/>
    <dl>
      <dt>External links</dt>
        <dd>
          <a href="http://www.micropython.org">micropython.org</a>
        </dd>
        <dd>
          <a href="http://github.com/micropython/micropython">GitHub</a>
        </dd>
    </dl>
  </div>
</div>
-->

  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.8',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>