

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>class ADC – analog to digital conversion &mdash; MicroPython 1.8 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/customstyle.css" type="text/css" />
  

  
    <link rel="top" title="MicroPython 1.8 documentation" href="../index.html"/>
        <link rel="up" title="MicroPython libraries" href="index.html"/>
        <link rel="next" title="class CAN – controller area network communication bus" href="pyb.CAN.html"/>
        <link rel="prev" title="class USB_VCP – USB virtual comm port" href="pyb.USB_VCP.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> MicroPython
          

          
            
            <img src="../_static/web-logo-sticky.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                1.8
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../openmvcam/quickref.html">Quick reference for the openmvcam</a></li>
<li class="toctree-l1"><a class="reference internal" href="../openmvcam/tutorial/index.html">OpenMV Cam Tutorial</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">MicroPython libraries</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#python-standard-libraries-and-micro-libraries">Python standard libraries and micro-libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#micropython-specific-libraries">MicroPython-specific libraries</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#libraries-specific-to-the-openmv-cam">Libraries specific to the OpenMV Cam</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="pyb.html"><code class="docutils literal"><span class="pre">pyb</span></code> &#8212; functions related to the board</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="pyb.html#time-related-functions">Time related functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="pyb.html#reset-related-functions">Reset related functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="pyb.html#interrupt-related-functions">Interrupt related functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="pyb.html#power-related-functions">Power related functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="pyb.html#miscellaneous-functions">Miscellaneous functions</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="pyb.html#classes">Classes</a></li>
</ul>
</li>
<li class="toctree-l3 current"><a class="current reference internal" href="">class ADC &#8211; analog to digital conversion</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#constructors">Constructors</a></li>
<li class="toctree-l4"><a class="reference internal" href="#methods">Methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-adcall-object">The ADCAll Object</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="pyb.CAN.html">class CAN &#8211; controller area network communication bus</a></li>
<li class="toctree-l3"><a class="reference internal" href="pyb.DAC.html">class DAC &#8211; digital to analog conversion</a></li>
<li class="toctree-l3"><a class="reference internal" href="pyb.ExtInt.html">class ExtInt &#8211; configure I/O pins to interrupt on external events</a></li>
<li class="toctree-l3"><a class="reference internal" href="pyb.I2C.html">class I2C &#8211; a two-wire serial protocol</a></li>
<li class="toctree-l3"><a class="reference internal" href="pyb.LED.html">class LED &#8211; LED object</a></li>
<li class="toctree-l3"><a class="reference internal" href="pyb.Pin.html">class Pin &#8211; control I/O pins</a></li>
<li class="toctree-l3"><a class="reference internal" href="pyb.Servo.html">class Servo &#8211; 3-wire hobby servo driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="pyb.SPI.html">class SPI &#8211; a master-driven serial protocol</a></li>
<li class="toctree-l3"><a class="reference internal" href="pyb.Timer.html">class Timer &#8211; control internal timers</a></li>
<li class="toctree-l3"><a class="reference internal" href="pyb.Timer.html#class-timerchannel-setup-a-channel-for-a-timer">class TimerChannel &#8212; setup a channel for a timer</a></li>
<li class="toctree-l3"><a class="reference internal" href="pyb.UART.html">class UART &#8211; duplex serial communication bus</a></li>
<li class="toctree-l3"><a class="reference internal" href="pyb.USB_VCP.html">class USB_VCP &#8211; USB virtual comm port</a></li>
<li class="toctree-l3"><a class="reference internal" href="omv.time.html"><code class="docutils literal"><span class="pre">time</span></code> &#8212; tracking elapsed time</a></li>
<li class="toctree-l3"><a class="reference internal" href="omv.sensor.html"><code class="docutils literal"><span class="pre">sensor</span></code> &#8212; camera sensor</a></li>
<li class="toctree-l3"><a class="reference internal" href="omv.image.html"><code class="docutils literal"><span class="pre">image</span></code> &#8212; machine vision</a></li>
<li class="toctree-l3"><a class="reference internal" href="omv.image.html#class-haarcascade-feature-descriptor">class HaarCascade &#8211; Feature Descriptor</a></li>
<li class="toctree-l3"><a class="reference internal" href="omv.image.html#class-histogram-histogram-object">class Histogram &#8211; Histogram Object</a></li>
<li class="toctree-l3"><a class="reference internal" href="omv.image.html#class-percentile-percentile-object">class Percentile &#8211; Percentile Object</a></li>
<li class="toctree-l3"><a class="reference internal" href="omv.image.html#class-statistics-statistics-object">class Statistics &#8211; Statistics Object</a></li>
<li class="toctree-l3"><a class="reference internal" href="omv.image.html#class-blob-blob-object">class Blob &#8211; Blob object</a></li>
<li class="toctree-l3"><a class="reference internal" href="omv.image.html#class-qrcode-qrcode-object">class QRCode &#8211; QRCode object</a></li>
<li class="toctree-l3"><a class="reference internal" href="omv.image.html#class-apriltag-apriltag-object">class AprilTag &#8211; AprilTag object</a></li>
<li class="toctree-l3"><a class="reference internal" href="omv.image.html#class-barcode-barcode-object">class BarCode &#8211; BarCode object</a></li>
<li class="toctree-l3"><a class="reference internal" href="omv.image.html#class-image-image-object">class Image &#8211; Image object</a></li>
<li class="toctree-l3"><a class="reference internal" href="omv.gif.html"><code class="docutils literal"><span class="pre">gif</span></code> &#8212; gif recording</a></li>
<li class="toctree-l3"><a class="reference internal" href="omv.gif.html#class-gif-gif-recorder">class Gif &#8211; Gif recorder</a></li>
<li class="toctree-l3"><a class="reference internal" href="omv.mjpeg.html"><code class="docutils literal"><span class="pre">mjpeg</span></code> &#8212; mjpeg recording</a></li>
<li class="toctree-l3"><a class="reference internal" href="omv.mjpeg.html#class-mjpeg-mjpeg-recorder">class Mjpeg &#8211; Mjpeg recorder</a></li>
<li class="toctree-l3"><a class="reference internal" href="omv.lcd.html"><code class="docutils literal"><span class="pre">lcd</span></code> &#8212; lcd shield driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="omv.fir.html"><code class="docutils literal"><span class="pre">fir</span></code> &#8212; thermopile shield driver (fir == far infrared)</a></li>
<li class="toctree-l3"><a class="reference internal" href="omv.cpufreq.html"><code class="docutils literal"><span class="pre">cpufreq</span></code> &#8212; easy cpu frequency control</a></li>
<li class="toctree-l3"><a class="reference internal" href="machine.html"><code class="docutils literal"><span class="pre">machine</span></code> &#8212; functions related to the board</a></li>
<li class="toctree-l3"><a class="reference internal" href="machine.I2C.html">class I2C &#8211; a two-wire serial protocol</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">The MicroPython language</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">MicroPython license information</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">MicroPython</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">MicroPython libraries</a> &raquo;</li>
      
    <li>class ADC &#8211; analog to digital conversion</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/library/pyb.ADC.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="class-adc-analog-to-digital-conversion">
<span id="pyb-adc"></span><h1>class ADC &#8211; analog to digital conversion<a class="headerlink" href="#class-adc-analog-to-digital-conversion" title="Permalink to this headline">¶</a></h1>
<p>Usage:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">pyb</span>

<span class="n">adc</span> <span class="o">=</span> <span class="n">pyb</span><span class="o">.</span><span class="n">ADC</span><span class="p">(</span><span class="n">pin</span><span class="p">)</span>              <span class="c"># create an analog object from a pin</span>
<span class="n">val</span> <span class="o">=</span> <span class="n">adc</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>                <span class="c"># read an analog value</span>

<span class="n">adc</span> <span class="o">=</span> <span class="n">pyb</span><span class="o">.</span><span class="n">ADCAll</span><span class="p">(</span><span class="n">resolution</span><span class="p">)</span>    <span class="c"># create an ADCAll object</span>
<span class="n">val</span> <span class="o">=</span> <span class="n">adc</span><span class="o">.</span><span class="n">read_channel</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span> <span class="c"># read the given channel</span>
<span class="n">val</span> <span class="o">=</span> <span class="n">adc</span><span class="o">.</span><span class="n">read_core_temp</span><span class="p">()</span>      <span class="c"># read MCU temperature</span>
<span class="n">val</span> <span class="o">=</span> <span class="n">adc</span><span class="o">.</span><span class="n">read_core_vbat</span><span class="p">()</span>      <span class="c"># read MCU VBAT</span>
<span class="n">val</span> <span class="o">=</span> <span class="n">adc</span><span class="o">.</span><span class="n">read_core_vref</span><span class="p">()</span>      <span class="c"># read MCU VREF</span>
</pre></div>
</div>
<div class="section" id="constructors">
<h2>Constructors<a class="headerlink" href="#constructors" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="pyb.ADC">
<em class="property">class </em><code class="descclassname">pyb.</code><code class="descname">ADC</code><span class="sig-paren">(</span><em>pin</em><span class="sig-paren">)</span><a class="headerlink" href="#pyb.ADC" title="Permalink to this definition">¶</a></dt>
<dd><p>Create an ADC object associated with the given pin.
This allows you to then read analog values on that pin.</p>
</dd></dl>

</div>
<div class="section" id="methods">
<h2>Methods<a class="headerlink" href="#methods" title="Permalink to this headline">¶</a></h2>
<dl class="method">
<dt>
<code class="descclassname">adc.</code><code class="descname">read</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd><p>Read the value on the analog pin and return it. The returned value
will be between 0 and 4095.</p>
</dd></dl>

<dl class="method">
<dt>
<code class="descclassname">adc.</code><code class="descname">read_timed</code><span class="sig-paren">(</span><em>buf</em>, <em>timer</em><span class="sig-paren">)</span></dt>
<dd><p>Read analog values into <code class="docutils literal"><span class="pre">buf</span></code> at a rate set by the <code class="docutils literal"><span class="pre">timer</span></code> object.</p>
<p><code class="docutils literal"><span class="pre">buf</span></code> can be bytearray or array.array for example. The ADC values have
12-bit resolution and are stored directly into <code class="docutils literal"><span class="pre">buf</span></code> if its element size is
16 bits or greater. If <code class="docutils literal"><span class="pre">buf</span></code> has only 8-bit elements (eg a bytearray) then
the sample resolution will be reduced to 8 bits.</p>
<p><code class="docutils literal"><span class="pre">timer</span></code> should be a Timer object, and a sample is read each time the timer
triggers. The timer must already be initialized and running at the desired
sampling frequency.</p>
<p>To support previous behavior of this function, <code class="docutils literal"><span class="pre">timer</span></code> can also be an
integer which specifies the frequency (in Hz) to sample at. In this case
Timer(6) will be automatically configured to run at the given frequency.</p>
<p>Example using a Timer object (preferred way):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">adc</span> <span class="o">=</span> <span class="n">pyb</span><span class="o">.</span><span class="n">ADC</span><span class="p">(</span><span class="s">&#39;P6&#39;</span><span class="p">)</span>                 <span class="c"># create an ADC on pin P6</span>
<span class="n">tim</span> <span class="o">=</span> <span class="n">pyb</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>         <span class="c"># create a timer running at 10Hz</span>
<span class="n">buf</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>                <span class="c"># create a buffer to store the samples</span>
<span class="n">adc</span><span class="o">.</span><span class="n">read_timed</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">tim</span><span class="p">)</span>            <span class="c"># sample 100 values, taking 10s</span>
</pre></div>
</div>
<p>Example using an integer for the frequency:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">adc</span> <span class="o">=</span> <span class="n">pyb</span><span class="o">.</span><span class="n">ADC</span><span class="p">(</span><span class="s">&#39;P6&#39;</span><span class="p">)</span>                 <span class="c"># create an ADC on pin P6</span>
<span class="n">buf</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>                <span class="c"># create a buffer of 100 bytes</span>
<span class="n">adc</span><span class="o">.</span><span class="n">read_timed</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>             <span class="c"># read analog values into buf at 10Hz</span>
                                    <span class="c">#   this will take 10 seconds to finish</span>
<span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">buf</span><span class="p">:</span>                     <span class="c"># loop over all values</span>
    <span class="k">print</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>                      <span class="c"># print the value out</span>
</pre></div>
</div>
<p>This function does not allocate any memory.</p>
</dd></dl>

</div>
<div class="section" id="the-adcall-object">
<h2>The ADCAll Object<a class="headerlink" href="#the-adcall-object" title="Permalink to this headline">¶</a></h2>
<p>Instantiating this changes all ADC pins to analog inputs. The raw MCU temperature,
VREF and VBAT data can be accessed on ADC channels 16, 17 and 18 respectively.
Appropriate scaling will need to be applied. The temperature sensor on the chip
has poor absolute accuracy and is suitable only for detecting temperature changes.</p>
<p>The <code class="docutils literal"><span class="pre">ADCAll</span></code> <code class="docutils literal"><span class="pre">read_core_vbat()</span></code> and <code class="docutils literal"><span class="pre">read_core_vref()</span></code> methods read
the backup battery voltage and the (1.21V nominal) reference voltage using the
3.3V supply as a reference. Assuming the <code class="docutils literal"><span class="pre">ADCAll</span></code> object has been Instantiated with
<code class="docutils literal"><span class="pre">adc</span> <span class="pre">=</span> <span class="pre">pyb.ADCAll(12)</span></code> the 3.3V supply voltage may be calculated:</p>
<p><code class="docutils literal"><span class="pre">v33</span> <span class="pre">=</span> <span class="pre">3.3</span> <span class="pre">*</span> <span class="pre">1.21</span> <span class="pre">/</span> <span class="pre">adc.read_core_vref()</span></code></p>
<p>If the 3.3V supply is correct the value of <code class="docutils literal"><span class="pre">adc.read_core_vbat()</span></code> will be
valid. If the supply voltage can drop below 3.3V, for example in in battery
powered systems with a discharging battery, the regulator will fail to preserve
the 3.3V supply resulting in an incorrect reading. To produce a value which will
remain valid under these circumstances use the following:</p>
<p><code class="docutils literal"><span class="pre">vback</span> <span class="pre">=</span> <span class="pre">adc.read_core_vbat()</span> <span class="pre">*</span> <span class="pre">1.21</span> <span class="pre">/</span> <span class="pre">adc.read_core_vref()</span></code></p>
<p>It is possible to access these values without incurring the side effects of <code class="docutils literal"><span class="pre">ADCAll</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">adcread</span><span class="p">(</span><span class="n">chan</span><span class="p">):</span>                              <span class="c"># 16 temp 17 vbat 18 vref</span>
    <span class="k">assert</span> <span class="n">chan</span> <span class="o">&gt;=</span> <span class="mi">16</span> <span class="ow">and</span> <span class="n">chan</span> <span class="o">&lt;=</span> <span class="mi">18</span><span class="p">,</span> <span class="s">&#39;Invalid ADC channel&#39;</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">pyb</span><span class="o">.</span><span class="n">millis</span><span class="p">()</span>
    <span class="n">timeout</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">stm</span><span class="o">.</span><span class="n">mem32</span><span class="p">[</span><span class="n">stm</span><span class="o">.</span><span class="n">RCC</span> <span class="o">+</span> <span class="n">stm</span><span class="o">.</span><span class="n">RCC_APB2ENR</span><span class="p">]</span> <span class="o">|=</span> <span class="mh">0x100</span> <span class="c"># enable ADC1 clock.0x4100</span>
    <span class="n">stm</span><span class="o">.</span><span class="n">mem32</span><span class="p">[</span><span class="n">stm</span><span class="o">.</span><span class="n">ADC1</span> <span class="o">+</span> <span class="n">stm</span><span class="o">.</span><span class="n">ADC_CR2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>       <span class="c"># Turn on ADC</span>
    <span class="n">stm</span><span class="o">.</span><span class="n">mem32</span><span class="p">[</span><span class="n">stm</span><span class="o">.</span><span class="n">ADC1</span> <span class="o">+</span> <span class="n">stm</span><span class="o">.</span><span class="n">ADC_CR1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>       <span class="c"># 12 bit</span>
    <span class="k">if</span> <span class="n">chan</span> <span class="o">==</span> <span class="mi">17</span><span class="p">:</span>
        <span class="n">stm</span><span class="o">.</span><span class="n">mem32</span><span class="p">[</span><span class="n">stm</span><span class="o">.</span><span class="n">ADC1</span> <span class="o">+</span> <span class="n">stm</span><span class="o">.</span><span class="n">ADC_SMPR1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x200000</span> <span class="c"># 15 cycles</span>
        <span class="n">stm</span><span class="o">.</span><span class="n">mem32</span><span class="p">[</span><span class="n">stm</span><span class="o">.</span><span class="n">ADC</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">23</span>
    <span class="k">elif</span> <span class="n">chan</span> <span class="o">==</span> <span class="mi">18</span><span class="p">:</span>
        <span class="n">stm</span><span class="o">.</span><span class="n">mem32</span><span class="p">[</span><span class="n">stm</span><span class="o">.</span><span class="n">ADC1</span> <span class="o">+</span> <span class="n">stm</span><span class="o">.</span><span class="n">ADC_SMPR1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x1000000</span>
        <span class="n">stm</span><span class="o">.</span><span class="n">mem32</span><span class="p">[</span><span class="n">stm</span><span class="o">.</span><span class="n">ADC</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0xc00000</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">stm</span><span class="o">.</span><span class="n">mem32</span><span class="p">[</span><span class="n">stm</span><span class="o">.</span><span class="n">ADC1</span> <span class="o">+</span> <span class="n">stm</span><span class="o">.</span><span class="n">ADC_SMPR1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x40000</span>
        <span class="n">stm</span><span class="o">.</span><span class="n">mem32</span><span class="p">[</span><span class="n">stm</span><span class="o">.</span><span class="n">ADC</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">23</span>
    <span class="n">stm</span><span class="o">.</span><span class="n">mem32</span><span class="p">[</span><span class="n">stm</span><span class="o">.</span><span class="n">ADC1</span> <span class="o">+</span> <span class="n">stm</span><span class="o">.</span><span class="n">ADC_SQR3</span><span class="p">]</span> <span class="o">=</span> <span class="n">chan</span>
    <span class="n">stm</span><span class="o">.</span><span class="n">mem32</span><span class="p">[</span><span class="n">stm</span><span class="o">.</span><span class="n">ADC1</span> <span class="o">+</span> <span class="n">stm</span><span class="o">.</span><span class="n">ADC_CR2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">30</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="c"># start conversion</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">stm</span><span class="o">.</span><span class="n">mem32</span><span class="p">[</span><span class="n">stm</span><span class="o">.</span><span class="n">ADC1</span> <span class="o">+</span> <span class="n">stm</span><span class="o">.</span><span class="n">ADC_SR</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">2</span><span class="p">:</span> <span class="c"># wait for EOC</span>
        <span class="k">if</span> <span class="n">pyb</span><span class="o">.</span><span class="n">elapsed_millis</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">timeout</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="s">&#39;ADC timout&#39;</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">stm</span><span class="o">.</span><span class="n">mem32</span><span class="p">[</span><span class="n">stm</span><span class="o">.</span><span class="n">ADC1</span> <span class="o">+</span> <span class="n">stm</span><span class="o">.</span><span class="n">ADC_DR</span><span class="p">]</span>     <span class="c"># clear down EOC</span>
    <span class="n">stm</span><span class="o">.</span><span class="n">mem32</span><span class="p">[</span><span class="n">stm</span><span class="o">.</span><span class="n">ADC1</span> <span class="o">+</span> <span class="n">stm</span><span class="o">.</span><span class="n">ADC_CR2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>       <span class="c"># Turn off ADC</span>
    <span class="k">return</span> <span class="n">data</span>

<span class="k">def</span> <span class="nf">v33</span><span class="p">():</span>
    <span class="k">return</span> <span class="mi">4096</span> <span class="o">*</span> <span class="mf">1.21</span> <span class="o">/</span> <span class="n">adcread</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">vbat</span><span class="p">():</span>
    <span class="k">return</span>  <span class="mf">1.21</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">adcread</span><span class="p">(</span><span class="mi">18</span><span class="p">)</span> <span class="o">/</span> <span class="n">adcread</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span>  <span class="c"># 2:1 divider on Vbat channel</span>

<span class="k">def</span> <span class="nf">vref</span><span class="p">():</span>
    <span class="k">return</span> <span class="mf">3.3</span> <span class="o">*</span> <span class="n">adcread</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4096</span>

<span class="k">def</span> <span class="nf">temperature</span><span class="p">():</span>
    <span class="k">return</span> <span class="mi">25</span> <span class="o">+</span> <span class="mi">400</span> <span class="o">*</span> <span class="p">(</span><span class="mf">3.3</span> <span class="o">*</span> <span class="n">adcread</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4096</span> <span class="o">-</span> <span class="mf">0.76</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="pyb.CAN.html" class="btn btn-neutral float-right" title="class CAN – controller area network communication bus" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="pyb.USB_VCP.html" class="btn btn-neutral" title="class USB_VCP – USB virtual comm port" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014-2017, Damien P. George, OpenMV LLC, and contributors.
      Last updated on 27 Mar 2017.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  <!--
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Ports and Versions</span>
    openmvcam (latest)
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Ports</dt>
      
        <dd><a href="//en/latest/unix">unix</a></dd>
      
        <dd><a href="//en/latest/pyboard">pyboard</a></dd>
      
        <dd><a href="//en/latest/wipy">wipy</a></dd>
      
        <dd><a href="//en/latest/esp8266">esp8266</a></dd>
      
        <dd><a href="//en/latest/openmvcam">openmvcam</a></dd>
      
    </dl>
    <dl>
      <dt>Versions</dt>
      
        <dd><a href="//en/latest/openmvcam">latest</a></dd>
      
    </dl>
    -->
    <!--
    <dl>
      <dt>Downloads</dt>
      
    </dl>
    -->
    <!--
    <hr/>
    <dl>
      <dt>External links</dt>
        <dd>
          <a href="http://www.micropython.org">micropython.org</a>
        </dd>
        <dd>
          <a href="http://github.com/micropython/micropython">GitHub</a>
        </dd>
    </dl>
  </div>
</div>
-->

  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.8',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>